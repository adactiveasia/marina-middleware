(()=>{var e={59:e=>{e.exports={secret:"adsign-secret-key"}},214:e=>{e.exports={HOST:"localhost",USER:"adsign",PASS:"6k3d9gWEUkPULD35",PORT:27017,DB_NAME:"adsign"}},523:(e,s,t)=>{const n=t(59),a=t(524),i=a.user,r=(a.role,t(722)),o=t(773);s.signup=(e,s)=>{const t=new i({email:e.body.email,password:o.hashSync(e.body.password,8)});i.findOne({email:e.body.email}).exec(((e,n)=>{e?s.status(500).send({message:e}):n?s.send({error:1,message:"Email registered"}):t.save(((e,t)=>{e?s.status(500).send({message:e}):s.send({error:0,message:"User was registered successfully!"})}))}))},s.signin=(e,s)=>{i.findOne({email:e.body.email}).exec(((t,a)=>{if(t)return void s.status(500).send({message:t});if(!a)return s.status(404).send({message:"User Not found."});if(!o.compareSync(e.body.password,a.password))return s.status(401).send({error:1,message:"Invalid Password!"});const i=r.sign({id:a.id},n.secret,{expiresIn:86400});s.status(200).send({error:0,id:a._id,email:a.email,name:a.name,accessToken:i})}))}},766:(e,s,t)=>{t(747),t(622);const n=t(123),a="admin@peoplenprops.com";s.send=async(e,s,t)=>{const{email:n}=e.body;try{return sendMail(n),s.status(201).json({message:"Email sent successefully"})}catch(e){e.statusCode||(e.statusCode=500),t(e)}},s.sendMail=(e,s)=>{const t=n.createTransport({host:"smtp.gmail.com",port:465,secure:!0,auth:{type:"OAuth2",user:a,clientId:"911102631843-p59ks7iislk081e8nlghse4ed7803ccb.apps.googleusercontent.com",clientSecret:"oKPo_rSkH9s7qFE2uCZZLhfk",refreshToken:"1//04OdU_iX9yqaGCgYIARAAGAQSNwF-L9IrZxbGVVa4_TXYQTec5vSWaMQkVPNEkfsMxWAJxm1WSdI4kTyYN5g92SQbhNrJRpElZSI",accessToken:"ya29.a0AfH6SMDkt7EXAo3ytJKs7ddUVr7u1VnE6v7y7b7hLZ22B0-5psRY1o_6qO_xBleCLvDZO3F2nEUVrbQp3qdUYJBQwNG4-6BpEcd0ibVTITd73rWPn02aLbJ3uV28YO0E_ZeJ5mBxX8-gFrDdxagzSzX-dBuQQLkZQ5Vgb8plEOY"}});t.verify();const i=e=>{let s="test";switch(e){case"1":s='\n            <h2 style="text-align: center;"><span style="font-weight: 400;">CONGRATULATIONS!&nbsp;</span></h2>\n            <h1 style="text-align: center;"><span style="font-weight: 400;">YOU HAVE WON</span></h1>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">5% OFF VOUCHER</span></h3>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">WITH NO MINIMUM SPEND*</span></h3>\n            <p style="text-align: center;">&nbsp;</p>\n            <img style="display: block; margin-left: auto; margin-right: auto; width: 50%;" src="cid:coupon@mac"/>\n            <p style="text-align: center;">&nbsp;</p>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">FLASH THIS EMAIL TO OUR ARTIST TO REDEEM!</span></h3>\n            <p style="text-align: center;"><span style="font-weight: 400;">*The voucher is only applicable for all regular priced items excluding mini M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C, VivaGlam and Accessories. This voucher cannot be used in conjunction with other in-store promotions. Valid till 31 December 2020. One-time use only. M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C Cosmetics Singapore reserve the rights to change these terms and conditions at any time without prior notice. M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C Cosmetics Singapore reserve the right of final decision in case of any disputes.</span></p>\n            ';break;case"2":s='\n            <h2 style="text-align: center;"><span style="font-weight: 400;">CONGRATULATIONS!&nbsp;</span></h2>\n            <h1 style="text-align: center;"><span style="font-weight: 400;">YOU HAVE WON</span></h1>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">$10 VOUCHER</span></h3>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">WITH NO MINIMUM SPEND*</span></h3>\n            <p style="text-align: center;">&nbsp;</p>\n            <img style="display: block; margin-left: auto; margin-right: auto; width: 50%;" src="cid:coupon@mac"/>\n            <p style="text-align: center;">&nbsp;</p>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">FLASH THIS EMAIL TO OUR ARTIST TO REDEEM!</span></h3>\n            <p style="text-align: center;"><span style="font-weight: 400;">*The voucher is only applicable for all regular priced items excluding mini M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C, VivaGlam and Accessories. This voucher cannot be used in conjunction with other in-store promotions. Valid till 31 December 2020. One-time use only. M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C Cosmetics Singapore reserve the rights to change these terms and conditions at any time without prior notice. M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C Cosmetics Singapore reserve the right of final decision in case of any disputes.</span></p>\n            ';break;case"3":s='\n            <h2 style="text-align: center;"><span style="font-weight: 400;">CONGRATULATIONS!&nbsp;</span></h2>\n            <h1 style="text-align: center;"><span style="font-weight: 400;">YOU HAVE WON</span></h1>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">FLUIDLINE BROW GEL CRÈME*</span></h3>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">FREE WITH EVERY PURCHASE</span></h3>\n            <p style="text-align: center;">&nbsp;</p>\n            <img style="display: block; margin-left: auto; margin-right: auto; width: 50%;" src="cid:coupon@mac"/>\n            <p style="text-align: center;">&nbsp;</p>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">FLASH THIS EMAIL TO OUR ARTIST TO REDEEM!</span></h3>\n            <p style="text-align: center;"><span style="font-weight: 400;">*The voucher is only applicable for all regular priced items excluding mini M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C, VivaGlam and Accessories. This voucher cannot be used in conjunction with other in-store promotions. Valid till 31 December 2020. One-time use only. M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C Cosmetics Singapore reserve the rights to change these terms and conditions at any time without prior notice. M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C Cosmetics Singapore reserve the right of final decision in case of any disputes.</span></p>\n            ';break;case"4":s='\n            <h2 style="text-align: center;"><span style="font-weight: 400;">CONGRATULATIONS!&nbsp;</span></h2>\n            <h1 style="text-align: center;"><span style="font-weight: 400;">YOU HAVE WON</span></h1>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">150S LARGE POWDER FACE BRUSH*</span></h3>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">FREE WITH EVERY PURCHASE</span></h3>\n            <p style="text-align: center;">&nbsp;</p>\n            <img style="display: block; margin-left: auto; margin-right: auto; width: 50%;" src="cid:coupon@mac"/>\n            <p style="text-align: center;">&nbsp;</p>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">FLASH THIS EMAIL TO OUR ARTIST TO REDEEM!</span></h3>\n            <p style="text-align: center;"><span style="font-weight: 400;">*The voucher is only applicable for all regular priced items excluding mini M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C, VivaGlam and Accessories. This voucher cannot be used in conjunction with other in-store promotions. Valid till 31 December 2020. One-time use only. M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C Cosmetics Singapore reserve the rights to change these terms and conditions at any time without prior notice. M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C Cosmetics Singapore reserve the right of final decision in case of any disputes.</span></p>\n            '}return s},r=e=>{let s="test";switch(e){case"1":s="5OFF.jpg";break;case"2":s="10OFF.jpg";break;case"3":s="BRUSH.jpg";break;case"4":s="CREME.jpg"}return s},o=e=>{let s="test";switch(e){case"1":s="./assets/5OFF.jpg";break;case"2":s="./assets/10OFF.jpg";break;case"3":s="./assets/BRUSH.jpg";break;case"4":s="./assets/CREME.jpg"}return s};return t.sendMail((s=>({from:a,to:e,subject:"YOU HAVE WON COUPON MAC",html:i(s),attachments:[{filename:r(s),path:o(s),cid:"coupon@mac"}]}))(s),((e,s)=>(s=e||s,e?(console.log(e),!1):(console.log("Message sent: "+s.response),!0)))),""}},973:(e,s,t)=>{const n=t(548).ObjectId,a=t(722),i=t(773),r=(t(484),t(59)),o=t(524),l=o.user,p=o.organization;s.create=async(e,s,t)=>{let a=await l.findOne({_id:n(e.user.id)});new p({name:e.body.name,desc:e.body.desc,modifiedAt:new Date,modifiedBy:a.email}).save(((e,t)=>{e?s.status(500).send({message:e}):s.send({error:0,message:"Organization was added successfully!"})}))},s.signin=(e,s)=>{l.findOne({email:e.body.email}).exec(((t,n)=>{if(t)return void s.status(500).send({message:t});if(!n)return s.status(404).send({message:"User Not found."});if(!i.compareSync(e.body.password,n.password))return s.status(401).send({error:1,message:"Invalid Password!"});const o=a.sign({id:n.id},r.secret,{expiresIn:86400});s.status(200).send({error:0,id:n._id,email:n.email,name:n.name,accessToken:o})}))}},611:(e,s,t)=>{const n=t(59),a=t(524),i=a.user,r=(a.role,t(722)),o=t(773),l=t(484);s.create=(e,s,t)=>{l.authenticateJWT(e,s,t),s.status(200).send({user:e.user})},s.signin=(e,s)=>{i.findOne({email:e.body.email}).exec(((t,a)=>{if(t)return void s.status(500).send({message:t});if(!a)return s.status(404).send({message:"User Not found."});if(!o.compareSync(e.body.password,a.password))return s.status(401).send({error:1,message:"Invalid Password!"});const i=r.sign({id:a.id},n.secret,{expiresIn:86400});s.status(200).send({error:0,id:a._id,email:a.email,name:a.name,accessToken:i})}))}},802:(e,s,t)=>{t(747),t(622),t(54);const n=t(189),a=t(766),i=t(773),r=t(484);s.win=async(e,s,t)=>{const{win:i,email:r,mobile:o,first:l,last:p,birthday:c,optin:g}=e.body;try{const e=await n.find({email:r}).countDocuments(),t=await n.find({mobile:o}).countDocuments();if(e+t<5&&e<4&&t<4){const e=new n({email:r,mobile:o,first:l,last:p,birthday:c,optin:g});await e.save();let t="",m="";try{t=a.sendMail(r,i)}catch(e){m=e}return s.status(200).json({error:0,message:"user saved successefully",info:t,mailError:m})}return s.status(200).json({error:1,message:"you have claim more than 3 times"})}catch(e){e.statusCode||(e.statusCode=500),t(e)}},s.listAllUsers=async(e,s,t)=>{if(r.authenticateJWT(e,s,t),console.log(parseInt(e.query.perpage)*(parseInt(e.query.page)-1)),e.user){const t=await n.find({$and:[{$or:[{username:{$regex:`.*${e.query.keyword}.*`}},{email:{$regex:`.*${e.query.keyword}.*`}},{name:{$regex:`.*${e.query.keyword}.*`}}]}]},{},{limit:parseInt(e.query.perpage),skip:parseInt(e.query.perpage)*(parseInt(e.query.page)-1)}).sort({[e.query.sort]:e.query.order});return s.status(200).json({error:0,message:"Fetch user successfully",data:t})}},s.addUser=async(e,s,t)=>{if(r.authenticateJWT(e,s,t),e.user){const t=await n.findById(e.user.id),a=e.body,r=new n;r.username=a.username,r.email=a.email,r.password=i.hashSync(a.password),r.name=a.name,r.organizationId=a.organizationId,r.organizationName=a.organizationName,r.access=a.access,r.modifiedAt=new Date,r.modifiedBy=t?t.email:null;const o=await r.save().catch((e=>({error:!0,message:e})));if(o.error)return void s.status(500).send({message:o.message});s.status(201).json({error:0,message:"User was added successfully!"})}},s.editUser=async(e,s,t)=>{if(r.authenticateJWT(e,s,t),e.user){const t=await n.findById(e.user.id),a=e.body,r=await n.findByIdAndUpdate(e.params.id);r.username=a.username,r.email=a.email,a.password&&(r.password=i.hashSync(a.password)),r.name=a.name,r.organizationId=a.organizationId,r.organizationName=a.organizationName,r.access=a.access,r.modifiedAt=new Date,r.modifiedBy=t?t.email:null;const o=await r.save().catch((e=>({error:!0,message:e})));if(o.error)return void s.status(500).send({message:o.message});s.status(201).json({error:0,message:"User was added successfully!"})}},s.deleteUser=async(e,s,t)=>{if(r.authenticateJWT(e,s,t),e.user){const t=await n.findByIdAndDelete(e.params.id).catch((e=>({error:!0,message:e})));if(t.error)return void s.status(500).send({message:t.message});s.status(201).json({error:0,message:"User was deleted successfully!"})}}},524:(e,s,t)=>{const n=t(619);n.Promise=global.Promise;const a={};a.mongoose=n,a.user=t(189),a.organization=t(273),e.exports=a},273:(e,s,t)=>{const n=t(619),a=n.model("Organization",new n.Schema({name:String,desc:String,modifiedAt:Number,modifiedBy:String}));e.exports=a},189:(e,s,t)=>{const n=t(619),a=n.model("User",new n.Schema({username:String,email:String,password:String,name:String,organizationId:{type:n.Schema.Types.ObjectId,ref:"Organization"},organizationName:String,access:Array,modifiedAt:Number,modifiedBy:String},{timestamps:!0}));e.exports=a},874:(e,s,t)=>{const n=t(127).Router(),{body:a}=t(756),i=t(523);n.post("/signup",[a("email").trim().isLength({min:5}),a("password").trim().isLength({min:8})],i.signup),n.post("/signin",[a("email").trim().isLength({min:5}),a("password").trim().isLength({min:8})],i.signin),e.exports=n},495:(e,s,t)=>{const n=t(127).Router(),{body:a}=t(756),i=t(973);n.post("/create",[a("name").trim().isLength({min:5}),a("desc").trim().isLength({min:5})],i.create),n.post("/signin",[a("email").trim().isLength({min:5}),a("password").trim().isLength({min:8})],i.signin),e.exports=n},398:(e,s,t)=>{const n=t(127).Router(),{body:a}=t(756),i=t(611);n.post("/create",[a("name").trim().isLength({min:5})],i.create),n.post("/signin",[a("email").trim().isLength({min:5}),a("password").trim().isLength({min:8})],i.signin),e.exports=n},800:(e,s,t)=>{const n=t(127).Router(),{body:a}=t(756),i=t(802),r=t(189),o=t(537),{mongoose:l}=(t(484),t(524));n.post("/win",[a("win").trim(),a("email").trim().isLength({min:5}),a("mobile").trim().isLength({min:5}),a("first").trim().isLength({min:2}),a("last").trim().isLength({min:2}),a("birthday").trim().isLength({min:5}),a("optin").trim().isLength({min:3})],i.win),n.get("/",i.listAllUsers),n.post("/",[a("username").notEmpty().withMessage("This field is required").custom((e=>r.findOne({username:e}).then((e=>{if(e)return Promise.reject("Username already taken! Please choose another one")})))),a("email").notEmpty().withMessage("This field is required").isEmail().withMessage("This field must be an email").trim().custom((e=>r.findOne({email:e}).then((e=>{if(e)return Promise.reject("Email already taken! Please choose another one")})))),a("password").notEmpty().isLength({min:6}).withMessage("Must be contain at least 6 chars long").trim()],o,i.addUser),n.post("/:id",[a("username").notEmpty().withMessage("This field is required").custom(((e,{req:s})=>r.findOne({username:e,_id:{$ne:l.Types.ObjectId(s.params.id)}}).then((e=>{if(e)return Promise.reject("Username already taken! Please choose another one")})))),a("email").notEmpty().withMessage("This field is required").isEmail().withMessage("This field must be an email").trim().custom(((e,{req:s})=>r.findOne({email:e,_id:{$ne:l.Types.ObjectId(s.params.id)}}).then((e=>{if(e)return Promise.reject("Email already taken! Please choose another one")})))),a("password").if((e=>e)).isLength({min:6}).withMessage("Must be contain at least 6 chars long").bail().trim()],o,i.editUser),n.delete("/:id",i.deleteUser),e.exports=n},484:(e,s,t)=>{const n=t(722),a=t(59);s.authenticateJWT=(e,s,t)=>{const i=e.headers.authorization;if(i){const t=i.split(" ")[1];n.verify(t,a.secret,((t,n)=>{if(t)return s.sendStatus(403);e.user=n}))}else s.sendStatus(401)}},537:(e,s,t)=>{const{validationResult:n}=t(756);e.exports=(e,s,t)=>{const a=n(e);if(a.isEmpty())return t();const i=[];return a.array().map((e=>i.push({[e.param]:e.msg}))),s.status(422).json({errors:i})}},983:e=>{"use strict";e.exports=require("@elastic/elasticsearch")},773:e=>{"use strict";e.exports=require("bcryptjs")},473:e=>{"use strict";e.exports=require("body-parser")},479:e=>{"use strict";e.exports=require("cors")},334:e=>{"use strict";e.exports=require("dotenv")},127:e=>{"use strict";e.exports=require("express")},756:e=>{"use strict";e.exports=require("express-validator")},54:e=>{"use strict";e.exports=require("firebase-admin")},747:e=>{"use strict";e.exports=require("fs")},722:e=>{"use strict";e.exports=require("jsonwebtoken")},548:e=>{"use strict";e.exports=require("mongodb")},619:e=>{"use strict";e.exports=require("mongoose")},633:e=>{"use strict";e.exports=require("multer")},123:e=>{"use strict";e.exports=require("nodemailer")},622:e=>{"use strict";e.exports=require("path")},231:e=>{"use strict";e.exports=require("uuid")}},s={};function t(n){if(s[n])return s[n].exports;var a=s[n]={exports:{}};return e[n](a,a.exports,t),a.exports}(()=>{t(334).config();const e=t(127),s=t(473),n=t(619),a=t(622),i=t(633),{v4:r}=t(231),o=t(479),{Client:l}=t(983),p=t(800),c=t(874),g=t(398),m=t(495),d=(t(214),new l({node:"http://localhost:9200"}),e()),h=i.diskStorage({destination:(e,s,t)=>{t(null,"images")},filename:(e,s,t)=>{t(null,r()+"-"+s.originalname)}});d.use(o()),d.use(s.json()),d.use(i({storage:h,fileFilter:(e,s,t)=>{"image/jpg"===s.mimetype||"image/png"===s.mimetype||"image/jpeg"===s.mimetype?t(null,!0):t(null,!1)}}).single("image")),d.use("/images",e.static(a.join(__dirname,"images"))),d.use(((e,s,t)=>{s.setHeader("Access-Control-Allow-Origin","*"),s.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, PATCH, DELETE"),t()})),d.use("/user",p),d.use("/auth",c),d.use("/site",g),d.use("/org",m),d.use(((e,s,t,n)=>{console.log(e);const a=e.statusCode||500,{message:i,data:r}=e;return t.status(a).json({message:i,data:r})})),n.connect("mongodb://localhost:27017/adsign",{useNewUrlParser:!0,useUnifiedTopology:!0}).then((e=>{d.listen("5000","127.0.0.1",(()=>console.log("App ready run on 127.0.0.1:5000")))})).catch((e=>console.log("ATLAS CONNECTION ERROR: ",e)))})()})();