(()=>{var e={8059:e=>{e.exports={secret:"adsign-secret-key"}},5214:e=>{e.exports={HOST:"localhost",USER:"adsign",PASS:"6k3d9gWEUkPULD35",PORT:27017,DB_NAME:"adsign"}},2523:(e,t,s)=>{const i=s(8059),a=s(6524).user,n=s(9722),r=s(2773),o=s(5484);t.signup=(e,t)=>{const s=new a({email:e.body.email,password:r.hashSync(e.body.password,8),isAdmin:e.body.isAdmin});a.findOne({email:e.body.email}).exec(((e,i)=>{e?t.status(500).send({message:e}):i?t.send({error:1,message:"Email registered"}):s.save(((e,s)=>{e?t.status(500).send({message:e}):t.send({error:0,message:"User was registered successfully!"})}))}))},t.changePassword=async(e,t,s)=>{if(o.authenticateJWT(e,t,s),e.user){const s=e.body,i=await a.findById(e.user.id);console.log(e.user.id),console.log(i),r.compareSync(s.oldPassword,i.password)?(i.password=r.hashSync(s.newPassword),i.isPasswordChanged=!0):t.status(400).send({error:1,message:"wrong password entered"});try{i.save().then((()=>{t.status(201).json({error:0,message:"password was changed successfully!"})}))}catch{}}},t.signin=async(e,t)=>{const s=await a.findOne({email:e.body.email});if(s)if(s.password)if(r.compareSync(e.body.password,s.password)){const e=n.sign({id:s.id},i.secret,{expiresIn:86400});t.status(200).send({error:0,id:s._id,email:s.email,name:s.name,organizationId:s.organizationId,organizationName:s.organizationName,access:s.access,accessToken:e,isAdmin:s.isAdmin,isPasswordChanged:s.isPasswordChanged})}else t.status(422).json({errors:{password:[{msg:"Invalid password"}]}});else t.status(422).json({errors:{email:[{msg:"Your account is inactive"}]}});else t.status(422).json({errors:{email:[{msg:"User not found"}]}})}},410:(e,t,s)=>{const i=s(5484),a=s(891),n=s(189);t.listAllCategories=async(e,t,s)=>{if(i.authenticateJWT(e,t,s),e.user){const e=await a.find();t.status(200).send({data:e})}},t.addCategory=async(e,t,s)=>{if(i.authenticateJWT(e,t,s),e.user){const s=await n.findById(e.user.id);console.log(e.body);const i=new a;i.name=e.body.name,i.description=e.body.description,i.siteId=e.body.siteId,i.modifiedBy=s?s.email:null,i.createdBy=s?s.email:null,i.save().then((()=>{t.status(201).json({error:0,message:"Category was added successfully!"})})).catch((e=>{t.status(500).send({message:e})}))}},t.editCategory=async(e,t,s)=>{if(i.authenticateJWT(e,t,s),e.user){const s=await n.findById(e.user.id),i=await a.findById(e.body.id);i.name=e.body.name,i.description=e.body.description,i.siteId=e.body.siteId,i.modifiedBy=s?s.email:null,i.createdBy=s?s.email:null,i.save().then((()=>{t.status(201).json({error:0,message:"Category was updated successfully!"})})).catch((e=>{t.status(500).send({message:e})}))}},t.getCategory=async(e,t,s)=>{i.authenticateJWT(e,t,s),e.user&&a.findById(e.body.id).populate("Category").then((async e=>{t.status(200).json({data:e,error:0})})).catch((e=>{t.status(500).send({message:e})}))},t.deleteCategory=async(e,t,s)=>{i.authenticateJWT(e,t,s),e.user&&a.findByIdAndDelete(e.query.id).then((()=>{t.status(201).json({error:0,message:"Category was deleted successfully!"})})).catch((e=>{t.status(500).send({message:e})}))}},9114:(e,t,s)=>{const i=s(7548).ObjectId,a=(s(9722),s(2773),s(5484)),n=(s(8059),s(6524)),r=n.user,o=n.feedback;s(5747),s(5619),t.getAll=async(e,t,s)=>{a.authenticateJWT(e,t,s),e.user&&o.find({siteId:e.query.siteId}).then((e=>{t.status(200).json({error:0,message:"Fetch data feedback success",data:e})})).catch((e=>{t.status(500).json({message:e})}))},t.edit=async(e,t,s)=>{a.authenticateJWT(e,t,s);let n=await r.findOne({_id:i(e.user.id)});const d=await o.findByIdAndUpdate(e.body.id);d.question=e.body.question,d.siteId=e.body.siteId,d.start=e.body.start,d.end=e.body.end,d.modifiedAt=new Date,d.modifiedBy=n.email,d.save().then((()=>{t.status(201).send({error:0,message:"Feedback was edited successfully!",data:e.body})}))},t.delete=async(e,t,s)=>{o.findByIdAndRemove(e.query.id,((e,s)=>{e?t.status(500).send({message:e}):t.send({error:0,message:"Feedback was deleted successfully!"})}))},t.create=async(e,t,s)=>{a.authenticateJWT(e,t,s);let n=await r.findOne({_id:i(e.user.id)});if(e.user){const s=new o({question:e.body.question,siteId:e.body.siteId,start:e.body.start,end:e.body.end,modifiedAt:new Date,modifiedBy:n.email});s.save(((e,i)=>{e?t.status(500).send({message:e,data:s}):t.status(201).send({error:0,message:"Feedback was added successfully!",data:s})}))}},t.get=async(e,t,s)=>{a.authenticateJWT(e,t,s),o.findById(e.query.id).then((e=>{t.json({data:e})})).catch((e=>{t.status(500).send({message:e})}))}},5766:(e,t,s)=>{s(5747),s(5622);const i=s(8123),a="admin@peoplenprops.com";t.send=async(e,t,s)=>{const{email:i}=e.body;try{return sendMail(i),t.status(201).json({message:"Email sent successefully"})}catch(e){e.statusCode||(e.statusCode=500),s(e)}},t.sendMail=(e,t)=>{const s=i.createTransport({host:"smtp.gmail.com",port:465,secure:!0,auth:{type:"OAuth2",user:a,clientId:"911102631843-p59ks7iislk081e8nlghse4ed7803ccb.apps.googleusercontent.com",clientSecret:"oKPo_rSkH9s7qFE2uCZZLhfk",refreshToken:"1//04OdU_iX9yqaGCgYIARAAGAQSNwF-L9IrZxbGVVa4_TXYQTec5vSWaMQkVPNEkfsMxWAJxm1WSdI4kTyYN5g92SQbhNrJRpElZSI",accessToken:"ya29.a0AfH6SMDkt7EXAo3ytJKs7ddUVr7u1VnE6v7y7b7hLZ22B0-5psRY1o_6qO_xBleCLvDZO3F2nEUVrbQp3qdUYJBQwNG4-6BpEcd0ibVTITd73rWPn02aLbJ3uV28YO0E_ZeJ5mBxX8-gFrDdxagzSzX-dBuQQLkZQ5Vgb8plEOY"}});s.verify();const n=e=>{let t="test";switch(e){case"1":t='\n            <h2 style="text-align: center;"><span style="font-weight: 400;">CONGRATULATIONS!&nbsp;</span></h2>\n            <h1 style="text-align: center;"><span style="font-weight: 400;">YOU HAVE WON</span></h1>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">5% OFF VOUCHER</span></h3>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">WITH NO MINIMUM SPEND*</span></h3>\n            <p style="text-align: center;">&nbsp;</p>\n            <img style="display: block; margin-left: auto; margin-right: auto; width: 50%;" src="cid:coupon@mac"/>\n            <p style="text-align: center;">&nbsp;</p>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">FLASH THIS EMAIL TO OUR ARTIST TO REDEEM!</span></h3>\n            <p style="text-align: center;"><span style="font-weight: 400;">*The voucher is only applicable for all regular priced items excluding mini M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C, VivaGlam and Accessories. This voucher cannot be used in conjunction with other in-store promotions. Valid till 31 December 2020. One-time use only. M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C Cosmetics Singapore reserve the rights to change these terms and conditions at any time without prior notice. M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C Cosmetics Singapore reserve the right of final decision in case of any disputes.</span></p>\n            ';break;case"2":t='\n            <h2 style="text-align: center;"><span style="font-weight: 400;">CONGRATULATIONS!&nbsp;</span></h2>\n            <h1 style="text-align: center;"><span style="font-weight: 400;">YOU HAVE WON</span></h1>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">$10 VOUCHER</span></h3>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">WITH NO MINIMUM SPEND*</span></h3>\n            <p style="text-align: center;">&nbsp;</p>\n            <img style="display: block; margin-left: auto; margin-right: auto; width: 50%;" src="cid:coupon@mac"/>\n            <p style="text-align: center;">&nbsp;</p>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">FLASH THIS EMAIL TO OUR ARTIST TO REDEEM!</span></h3>\n            <p style="text-align: center;"><span style="font-weight: 400;">*The voucher is only applicable for all regular priced items excluding mini M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C, VivaGlam and Accessories. This voucher cannot be used in conjunction with other in-store promotions. Valid till 31 December 2020. One-time use only. M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C Cosmetics Singapore reserve the rights to change these terms and conditions at any time without prior notice. M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C Cosmetics Singapore reserve the right of final decision in case of any disputes.</span></p>\n            ';break;case"3":t='\n            <h2 style="text-align: center;"><span style="font-weight: 400;">CONGRATULATIONS!&nbsp;</span></h2>\n            <h1 style="text-align: center;"><span style="font-weight: 400;">YOU HAVE WON</span></h1>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">FLUIDLINE BROW GEL CRÈME*</span></h3>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">FREE WITH EVERY PURCHASE</span></h3>\n            <p style="text-align: center;">&nbsp;</p>\n            <img style="display: block; margin-left: auto; margin-right: auto; width: 50%;" src="cid:coupon@mac"/>\n            <p style="text-align: center;">&nbsp;</p>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">FLASH THIS EMAIL TO OUR ARTIST TO REDEEM!</span></h3>\n            <p style="text-align: center;"><span style="font-weight: 400;">*The voucher is only applicable for all regular priced items excluding mini M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C, VivaGlam and Accessories. This voucher cannot be used in conjunction with other in-store promotions. Valid till 31 December 2020. One-time use only. M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C Cosmetics Singapore reserve the rights to change these terms and conditions at any time without prior notice. M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C Cosmetics Singapore reserve the right of final decision in case of any disputes.</span></p>\n            ';break;case"4":t='\n            <h2 style="text-align: center;"><span style="font-weight: 400;">CONGRATULATIONS!&nbsp;</span></h2>\n            <h1 style="text-align: center;"><span style="font-weight: 400;">YOU HAVE WON</span></h1>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">150S LARGE POWDER FACE BRUSH*</span></h3>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">FREE WITH EVERY PURCHASE</span></h3>\n            <p style="text-align: center;">&nbsp;</p>\n            <img style="display: block; margin-left: auto; margin-right: auto; width: 50%;" src="cid:coupon@mac"/>\n            <p style="text-align: center;">&nbsp;</p>\n            <h3 style="text-align: center;"><span style="font-weight: 400;">FLASH THIS EMAIL TO OUR ARTIST TO REDEEM!</span></h3>\n            <p style="text-align: center;"><span style="font-weight: 400;">*The voucher is only applicable for all regular priced items excluding mini M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C, VivaGlam and Accessories. This voucher cannot be used in conjunction with other in-store promotions. Valid till 31 December 2020. One-time use only. M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C Cosmetics Singapore reserve the rights to change these terms and conditions at any time without prior notice. M</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">A</span><span style="font-weight: 400;">∙</span><span style="font-weight: 400;">C Cosmetics Singapore reserve the right of final decision in case of any disputes.</span></p>\n            '}return t},r=e=>{let t="test";switch(e){case"1":t="5OFF.jpg";break;case"2":t="10OFF.jpg";break;case"3":t="BRUSH.jpg";break;case"4":t="CREME.jpg"}return t},o=e=>{let t="test";switch(e){case"1":t="./assets/5OFF.jpg";break;case"2":t="./assets/10OFF.jpg";break;case"3":t="./assets/BRUSH.jpg";break;case"4":t="./assets/CREME.jpg"}return t};return s.sendMail((t=>({from:a,to:e,subject:"YOU HAVE WON COUPON MAC",html:n(t),attachments:[{filename:r(t),path:o(t),cid:"coupon@mac"}]}))(t),((e,t)=>(t=e||t,e?(console.log(e),!1):(console.log("Message sent: "+t.response),!0)))),""}},1883:(e,t,s)=>{const i=s(5747),a=s(8194),n=s(5484);t.listAllMaps=async(e,t,s)=>{n.authenticateJWT(e,t,s),e.user&&a.find().then((e=>{t.status(200).json({error:0,message:"Fetch map successfully",data:e})})).catch((e=>{t.status(500).send({message:e})}))},t.addMap=async(e,t,s)=>{if(n.authenticateJWT(e,t,s),e.user){const s=await a.findById(e.user.id),i=e.body,n=new a;n.name=i.name,n.description=i.description,n.userPos=i.userPos,n.siteId=i.siteId,n.createdBy=s?s.email:null,e.file&&(n.fileUrl=e.file.filename),n.save().then((()=>{t.status(201).json({error:0,message:"Map was added successfully!",data:n})})).catch((e=>{t.status(500).send({message:e})}))}},t.editMap=async(e,t,s)=>{if(n.authenticateJWT(e,t,s),e.user){const s=await a.findById(e.user.id),n=e.body,r=await a.findByIdAndUpdate(n.id);r.name=n.name?n.name:r.name,r.description=n.description?n.description:r.description,r.userPos=n.userPos?n.userPos:r.userPos,r.siteId=n.siteId?n.siteId:r.siteId,r.modifiedBy=s?s.email:null,r.paths=n.paths?n.paths:r.paths,r.mapPos=n.mapPos?n.mapPos:r.mapPos,e.file&&(r.fileUrl&&i.existsSync(`images/map/${r.fileUrl}`)&&i.unlinkSync(`images/map/${r.fileUrl}`),r.fileUrl=e.file.filename),r.save().then((()=>{t.status(201).json({error:0,message:"Map was updated successfully!",data:r})})).catch((e=>{t.status(500).send({message:e})}))}},t.deleteMap=async(e,t,s)=>{if(n.authenticateJWT(e,t,s),e.user){const s=await a.findById(e.query.id);s&&s.fileUrl&&i.existsSync(`images/map/${s.fileUrl}`)&&i.unlinkSync(`images/map/${s.fileUrl}`),a.findByIdAndDelete(e.query.id).then((()=>{t.status(201).json({error:0,message:"Map was deleted successfully!"})})).catch((e=>{t.status(500).send({message:e})}))}},t.getMap=async(e,t,s)=>{n.authenticateJWT(e,t,s),e.user&&a.findById(e.query.id).then((e=>{t.json({data:e})})).catch((e=>{t.status(500).send({message:e})}))}},8570:(e,t,s)=>{const i=s(7548).ObjectId,a=(s(9722),s(2773),s(5484)),n=(s(8059),s(6524)),r=n.user,o=n.media,d=s(5747);s(5619),t.getAll=async(e,t,s)=>{a.authenticateJWT(e,t,s),e.user&&o.find({siteId:e.query.siteId}).then((e=>{t.status(200).json({error:0,message:"Fetch data media success",data:e})})).catch((e=>{t.status(500).json({message:e})}))},t.edit=async(e,t,s)=>{a.authenticateJWT(e,t,s);let n=await r.findOne({_id:i(e.user.id)});const c=await o.findByIdAndUpdate(e.body.id);c.name=e.body.name,c.description=e.body.description,c.siteId=e.body.siteId,c.categoryId=e.body.categoryId,c.categoryName=e.body.categoryName,c.days=JSON.parse(e.body.days),c.dates=JSON.parse(e.body.dates),c.duration=e.body.duration,c.type=e.body.type,c.color=e.body.color,e.body.start&&(c.start=e.body.start),e.body.end&&(c.end=e.body.end),e.file&&(c.logo&&d.existsSync(`images/media/${c.logo}`)&&d.unlinkSync(`images/media/${c.logo}`),c.logo=e.file.filename,c.fileType=e.file.mimetype),c.modifiedAt=new Date,c.modifiedBy=n.email,c.save().then((()=>{t.status(201).send({error:0,message:"Media was edited successfully!",data:c})}))},t.delete=async(e,t,s)=>{const i=await o.findById(e.query.id);i&&i.logo&&d.existsSync(`images/media/${i.logo}`)&&d.unlinkSync(`images/media/${i.logo}`),o.findByIdAndRemove(e.query.id,((e,s)=>{e?t.status(500).send({message:e}):t.send({error:0,message:"Media was deleted successfully!"})}))},t.create=async(e,t,s)=>{a.authenticateJWT(e,t,s);let n=await r.findOne({_id:i(e.user.id)});const d=new o({name:e.body.name,description:e.body.description,siteId:e.body.siteId,categoryId:e.body.categoryId,categoryName:e.body.categoryName,days:JSON.parse(e.body.days),dates:JSON.parse(e.body.dates),duration:e.body.duration,type:e.body.type,color:e.body.color,modifiedAt:new Date,modifiedBy:n.email});e.body.start&&(d.start=e.body.start),e.body.end&&(d.end=e.body.end),e.file&&(d.logo=e.file.filename,d.fileType=e.file.mimetype),d.save(((e,s)=>{e?t.status(500).send({message:e,data:d}):t.status(201).send({error:0,message:"Media was added successfully!",data:d})}))},t.get=async(e,t,s)=>{a.authenticateJWT(e,t,s),o.findById(e.query.id).then((e=>{t.json({data:e})})).catch((e=>{t.status(500).send({message:e})}))},t.calendar=async(e,t,s)=>{a.authenticateJWT(e,t,s),o.find({siteId:e.query.siteId}).then((e=>{t.json({data:e})})).catch((e=>{t.status(500).send({message:e})}))}},4973:(e,t,s)=>{const i=s(5484),a=s(273),n=s(189);t.listAllOrganizations=async(e,t,s)=>{if(i.authenticateJWT(e,t,s),e.user){const e=await a.find();t.status(200).send({data:e})}},t.addOrganization=async(e,t,s)=>{if(i.authenticateJWT(e,t,s),e.user){const s=await n.findById(e.user.id),i=new a;i.name=e.body.name,i.description=e.body.description,i.modifiedBy=s?s.email:null,i.createdBy=s?s.email:null,i.save().then((()=>{t.status(201).json({error:0,message:"User was added successfully!"})})).catch((e=>{t.status(500).send({message:e})}))}},t.editOrganization=async(e,t,s)=>{if(i.authenticateJWT(e,t,s),e.user){const s=await n.findById(e.user.id),i=await a.findById(e.params.id);i.name=e.body.name,i.description=e.body.description,i.modifiedBy=s?s.email:null,i.createdBy=s?s.email:null,i.save().then((()=>{t.status(201).json({error:0,message:"User was added successfully!"})})).catch((e=>{t.status(500).send({message:e})}))}},t.getOrganization=async(e,t,s)=>{i.authenticateJWT(e,t,s),e.user&&a.findById(e.body.id).populate("Organization").then((async e=>{t.status(200).json({data:e,error:0})})).catch((e=>{t.status(500).send({message:e})}))},t.deleteOrganization=async(e,t,s)=>{i.authenticateJWT(e,t,s),e.user&&a.findByIdAndDelete(e.query.id).then((()=>{t.status(201).json({error:0,message:"Organization was deleted successfully!"})})).catch((e=>{t.status(500).send({message:e})}))}},4520:(e,t,s)=>{const i=s(7548).ObjectId,a=(s(9722),s(2773),s(5484)),n=(s(8059),s(6524)),r=n.user,o=n.poi,d=s(5747);t.getAll=async(e,t,s)=>{a.authenticateJWT(e,t,s),e.user&&o.find().then((e=>{t.status(200).json({error:0,message:"Fetch data poi success",data:e})})).catch((e=>{t.status(500).json({message:e})}))},t.edit=async(e,t,s)=>{a.authenticateJWT(e,t,s);let n=await r.findOne({_id:i(e.user.id)});const c=await o.findByIdAndUpdate(e.body.id);c.name=e.body.name,c.description=e.body.description,c.siteId=e.body.siteId,c.categoryId=e.body.categoryId,c.categoryName=e.body.categoryName,c.floor=e.body.floor,c.location=e.body.location,e.file&&(c.logo&&d.existsSync(`images/poi/${c.logo}`)&&d.unlinkSync(`images/poi/${c.logo}`),c.logo=e.file.filename),c.opentime=e.body.opentime,c.phone=e.body.phone,c.priority=e.body.priority,c.tag=e.body.tag,c.url=e.body.url,c.modifiedAt=new Date,c.modifiedBy=n.email,c.save().then((()=>{t.send({error:0,message:"Poi was edited successfully!"})}))},t.delete=async(e,t,s)=>{const i=await o.findById(e.query.id);i&&i.logo&&d.existsSync(`images/poi/${i.logo}`)&&d.unlinkSync(`images/poi/${i.logo}`),o.findByIdAndRemove(e.query.id,((e,s)=>{e?t.status(500).send({message:e}):t.send({error:0,message:"Poi was deleted successfully!"})}))},t.create=async(e,t,s)=>{a.authenticateJWT(e,t,s);let n=await r.findOne({_id:i(e.user.id)});const d=new o({name:e.body.name,description:e.body.description,siteId:e.body.siteId,categoryId:e.body.categoryId,categoryName:e.body.categoryName,floor:e.body.floor,location:e.body.location,opentime:e.body.opentime,phone:e.body.phone,priority:e.body.priority,tag:e.body.tag,url:e.body.url,modifiedAt:new Date,modifiedBy:n.email});e.file&&(d.logo=e.file.filename),d.save(((e,s)=>{e?t.status(500).send({message:e}):t.send({error:0,message:"Poi was added successfully!"})}))}},534:(e,t,s)=>{const i=s(7548).ObjectId,a=(s(9722),s(2773),s(5484)),n=(s(8059),s(189)),r=s(8267);t.getAll=async(e,t,s)=>{a.authenticateJWT(e,t,s),e.user&&r.find().then((e=>{t.status(200).json({error:0,message:"Fetch data poi category success",data:e})})).catch((e=>{t.status(500).json({message:e})}))},t.edit=async(e,t,s)=>{a.authenticateJWT(e,t,s);let o=await n.findOne({_id:i(e.user.id)});const d=await r.findById(e.body.id);d.name=e.body.name,d.description=e.body.description,d.siteId=e.body.siteId,d.modifiedAt=new Date,d.modifiedBy=o.email,d.save(((e,s)=>{e?t.status(500).send({message:e}):t.send({error:0,message:"Poi Category was added successfully!"})}))},t.delete=async(e,t,s)=>{a.authenticateJWT(e,t,s),r.findByIdAndRemove(e.query.id,((e,s)=>{e?t.status(500).send({message:e}):t.send({error:0,message:"Poi Category was deleted successfully!"})}))},t.create=async(e,t,s)=>{a.authenticateJWT(e,t,s);let o=await n.findOne({_id:i(e.user.id)});new r({name:e.body.name,description:e.body.description,siteId:e.body.siteId,modifiedAt:new Date,modifiedBy:o.email}).save(((e,s)=>{e?t.status(500).send({message:e}):t.send({error:0,message:"Poi Category was added successfully!"})}))}},4955:(e,t,s)=>{const i=s(6524).respondent,a=s(5484),n=s(2164),r=s(2470),o=s(3366);t.create=async(e,t,s)=>{const a=await o.findById(e.body.feedbackId);if(a.start&&a.end){const s=new i({feedbackId:e.body.feedbackId,star:e.body.star});s.save(((e,i)=>{e?t.status(500).send({message:e,data:s}):t.status(201).send({error:0,message:"Respondent was added successfully!",data:s})}))}else t.status(400).json({message:"Cannot send feedback because the date is not setted!"})},t.get=async(e,t,s)=>{if(a.authenticateJWT(e,t,s),e.user){const s=await i.find({feedbackId:e.query.id}),a=s.length,o=n.reduce(s,((e,t)=>t.star+e),0),d=[],c={star1:[],star2:[],star3:[],star4:[],star5:[]};return n.mapObject(n.groupBy(s,(e=>r(e.createdAt).format("DD/MM/YYYY"))),((e,t)=>{d.push(t);const s=e.filter((e=>1===e.star)),i=e.filter((e=>2===e.star)),a=e.filter((e=>3===e.star)),n=e.filter((e=>4===e.star)),r=e.filter((e=>5===e.star));c.star1.push(s?s.length:0),c.star2.push(i?i.length:0),c.star3.push(a?a.length:0),c.star4.push(n?n.length:0),c.star5.push(r?r.length:0)})),t.json({data:{dataSet:c,labels:d,total:a,average:o/a}})}}},8130:(e,t,s)=>{const i=s(5484),a=s(1011);s(189),t.getAll=async(e,t,s)=>{i.authenticateJWT(e,t,s),e.user&&a.aggregate([{$match:{siteId:e.query.siteId,createdAt:{$gt:new Date(Date.now()-864e5)}}},{$sort:{createdAt:-1}},{$group:{_id:"$mapId",latest:{$first:"$$ROOT"}}}]).then((e=>{t.status(200).json({error:0,message:"Fetch data screenshot success",data:e})})).catch((e=>{t.status(500).json({message:e})}))},t.delete=async(e,t,s)=>{console.log(e,"<<<< req"),i.authenticateJWT(e,t,s),e.user&&a.findByIdAndDelete(e.query.id).then((()=>{t.status(201).json({error:0,message:"Screenshot was deleted successfully!"})})).catch((e=>{t.status(500).send({message:e})}))},t.create=async(e,t,s)=>{if(i.authenticateJWT(e,t,s),console.log(e,"<<<<< request body "),e.user){const s=new a({name:e.body.name,siteId:e.body.siteId,mapId:e.body.mapId,mapName:e.body.mapName,image:e.body.image,modifiedAt:new Date});s.save(((e,i)=>{e?t.status(500).send({message:e,data:s}):t.status(201).send({error:0,message:"Screenshot was added successfully!",data:s})}))}},t.get=async(e,t,s)=>{i.authenticateJWT(e,t,s),a.findById(e.query.id).then((e=>{t.json({data:e})})).catch((e=>{t.status(500).send({message:e})}))},t.getEveryHour=async(e,t,s)=>{i.authenticateJWT(e,t,s),a.aggregate([{$match:{siteId:e.query.siteId,mapId:e.query.mapId,createdAt:{$gt:new Date(Date.now()-864e5)}}},{$sort:{createdAt:-1}},{$group:{_id:{$hour:"$createdAt"},latest:{$first:"$$ROOT"}}}]).then((e=>{t.json({data:e})})).catch((e=>{t.status(500).send({message:e})}))},t.getStatus=async(e,t,s)=>{i.authenticateJWT(e,t,s),a.find({createdAt:{$gt:new Date(Date.now()-6e4)},mapId:e.query.mapId}).then((e=>{e.length?t.status(200).send({error:0,message:"Active"}):t.status(200).send({error:0,message:"Inactive"})})).catch((e=>{t.status(500).send({message:e})}))}},8611:(e,t,s)=>{const i=s(5484),a=s(7313),n=s(189);t.listAllSites=async(e,t,s)=>{if(i.authenticateJWT(e,t,s),e.user){const e=await a.find();t.status(200).send({data:e})}},t.addSite=async(e,t,s)=>{if(i.authenticateJWT(e,t,s),e.user){const s=await n.findById(e.user.id),i=new a;i.name=e.body.name,i.description=e.body.description,i.organizationId=e.body.organizationId,i.organizationName=e.body.organizationName,i.modifiedBy=s?s.email:null,i.createdBy=s?s.email:null,i.save().then((()=>{t.status(201).json({error:0,message:"Site was added successfully!"})})).catch((e=>{t.status(500).send({message:e})}))}},t.editSite=async(e,t,s)=>{if(i.authenticateJWT(e,t,s),e.user){const s=await n.findById(e.user.id),i=await a.findById(e.params.id);i.name=e.body.name,i.description=e.body.description,i.organizationId=e.body.organizationId,i.organizationName=e.body.organizationName,i.modifiedBy=s?s.email:null,i.createdBy=s?s.email:null,i.save().then((()=>{t.status(201).json({error:0,message:"Site was added successfully!"})})).catch((e=>{t.status(500).send({message:e})}))}},t.getSite=async(e,t,s)=>{i.authenticateJWT(e,t,s),e.user&&a.findById(e.body.id).populate("Organization").then((async e=>{t.status(200).json({data:e,error:0})})).catch((e=>{t.status(500).send({message:e})}))},t.deleteSite=async(e,t,s)=>{i.authenticateJWT(e,t,s),e.user&&a.findByIdAndDelete(e.query.id).then((()=>{t.status(201).json({error:0,message:"Site was deleted successfully!"})})).catch((e=>{t.status(500).send({message:e})}))}},7802:(e,t,s)=>{const i=s(5747),a=(s(5622),s(4054),s(189)),n=s(7313),r=s(273),o=s(5766),d=s(2773),c=s(5484),{mongoose:p}=s(6524);t.win=async(e,t,s)=>{const{win:i,email:n,mobile:r,first:d,last:c,birthday:p,optin:m}=e.body;try{const e=await a.find({email:n}).countDocuments(),s=await a.find({mobile:r}).countDocuments();if(e+s<5&&e<4&&s<4){const e=new a({email:n,mobile:r,first:d,last:c,birthday:p,optin:m});await e.save();let s="",u="";try{s=o.sendMail(n,i)}catch(e){u=e}return t.status(200).json({error:0,message:"user saved successefully",info:s,mailError:u})}return t.status(200).json({error:1,message:"you have claim more than 3 times"})}catch(e){e.statusCode||(e.statusCode=500),s(e)}},t.listAllUsers=async(e,t,s)=>{c.authenticateJWT(e,t,s),e.user&&a.find().then((e=>{t.status(200).json({error:0,message:"Fetch user successfully",data:e})})).catch((e=>{t.status(500).send({message:e})}))},t.addUser=async(e,t,s)=>{if(c.authenticateJWT(e,t,s),e.user){const s=await a.findById(e.user.id),i=e.body,n=new a;n.isAdmin=i.isAdmin,n.email=i.email,n.name=i.name,n.password=d.hashSync(i.password),n.organizationId=i.organizationId,n.organizationName=i.organizationName,n.access=i.access,n.modifiedBy=s?s.email:null,n.createdBy=s?s.email:null,e.file&&(n.logoUrl=e.file.filename),n.save().then((()=>{t.status(201).json({error:0,message:"User was added successfully!"})})).catch((e=>{t.status(500).send({message:e})}))}},t.editUser=async(e,t,s)=>{if(c.authenticateJWT(e,t,s),console.log(e.params),e.user){const s=await a.findById(e.user.id),n=e.body,r=await a.findByIdAndUpdate(n.id);r.username=n.username,r.email=n.email,n.password&&(r.password=d.hashSync(n.password)),r.name=n.name,r.isAdmin=n.isAdmin,r.organizationId=n.organizationId,r.organizationName=n.organizationName,r.access=n.access,r.modifiedBy=s?s.email:null,e.file&&(r.logoUrl&&i.existsSync(`images/user/${r.logoUrl}`)&&i.unlinkSync(`images/user/${r.logoUrl}`),r.logoUrl=e.file.filename),r.save().then((()=>{t.status(201).json({error:0,message:"User was updated successfully!",data:r})})).catch((e=>{t.status(500).send({message:e})}))}},t.deleteUser=async(e,t,s)=>{if(c.authenticateJWT(e,t,s),e.user){const s=await a.findById(e.query.id);s&&s.logo&&i.existsSync(`images/user/${s.logo}`)&&i.unlinkSync(`images/user/${s.logo}`),a.findByIdAndDelete(e.query.id).then((()=>{t.status(201).json({error:0,message:"User was deleted successfully!"})})).catch((e=>{t.status(500).send({message:e})}))}},t.getUser=async(e,t,s)=>{if(c.authenticateJWT(e,t,s),e.user){const s=await n.find(),i=await r.find();a.findById(e.body.id).then((e=>{t.json({data:e,site:s,organization:i})})).catch((e=>{t.status(500).send({message:e})}))}},t.access=async(e,t,s)=>{c.authenticateJWT(e,t,s),e.user&&a.findByIdAndUpdate(e.body._id,{access:e.body.access}).then((e=>{t.status(200).json({data:e,error:0})})).catch((e=>{t.status(500).send({message:e})}))}},891:(e,t,s)=>{const i=s(5619),a=i.model("Category",new i.Schema({name:String,description:String,siteId:{type:i.Types.ObjectId,ref:"Site"},modifiedAt:Number,modifiedBy:String},{timestamps:!0}));e.exports=a},3366:(e,t,s)=>{const i=s(5619),a=i.model("Feedback",new i.Schema({question:String,siteId:{type:i.Types.ObjectId,ref:"Site"},start:Date,end:Date,modifiedAt:Number,modifiedBy:String},{timestamps:!0}));e.exports=a},6524:(e,t,s)=>{const i=s(5619);i.Promise=global.Promise;const a={};a.mongoose=i,a.user=s(189),a.organization=s(273),a.poi=s(5476),a.poiCategory=s(8267),a.category=s(891),a.media=s(8369),a.feedback=s(3366),a.respondent=s(5199),e.exports=a},8194:(e,t,s)=>{const i=s(5619),a=i.model("Map",new i.Schema({name:String,description:String,mapPos:Object,siteId:{type:i.Schema.Types.ObjectId,ref:"Site"},fileUrl:String,paths:Array,userPos:Object,modifiedBy:String,createdBy:String},{timestamps:!0}));e.exports=a},8369:(e,t,s)=>{const i=s(5619),a=i.model("Media",new i.Schema({name:String,description:String,siteId:{type:i.Types.ObjectId,ref:"Site"},categoryId:{type:i.Types.ObjectId,ref:"Category"},categoryName:String,days:Array,dates:Array,duration:Number,logo:String,fileType:String,color:String,type:String,start:Date,end:Date,modifiedAt:Number,modifiedBy:String}));e.exports=a},273:(e,t,s)=>{const i=s(5619),a=i.model("Organization",new i.Schema({name:String,description:String,modifiedAt:Number,modifiedBy:String}));e.exports=a},5476:(e,t,s)=>{const i=s(5619),a=i.model("Poi",new i.Schema({name:String,description:String,siteId:{type:i.Types.ObjectId,ref:"Site"},categoryId:{type:i.Types.ObjectId,ref:"PoiCategory"},categoryName:String,floor:String,location:String,logo:String,logoUrl:String,opentime:String,phone:String,priority:String,tag:String,url:String,modifiedAt:Number,modifiedBy:String}));e.exports=a},8267:(e,t,s)=>{const i=s(5619),a=i.model("PoiCategory",new i.Schema({name:String,description:String,modifiedAt:Number,modifiedBy:String,siteId:String}));e.exports=a},5199:(e,t,s)=>{const i=s(5619),a=i.model("Respondent",new i.Schema({feedbackId:{type:i.Types.ObjectId,ref:"feedback"},star:Number},{timestamps:!0}));e.exports=a},1011:(e,t,s)=>{const i=s(5619),a=i.model("Screenshot",new i.Schema({name:String,siteId:String,image:String,mapId:String,mapName:String,modifiedAt:Number,createdAt:{type:Date,default:Date.now}}).index({createdAt:1},{expireAfterSeconds:7776e3}));e.exports=a},7313:(e,t,s)=>{const i=s(5619),a=i.model("Site",new i.Schema({name:String,description:String,organizationId:{type:i.Schema.Types.ObjectId,ref:"Organization"},organizationName:String,modifiedBy:String,createdBy:String},{timestamps:!0}));e.exports=a},189:(e,t,s)=>{const i=s(5619),a=i.model("User",new i.Schema({username:String,email:String,password:String,name:String,isAdmin:Boolean,organizationId:{type:i.Schema.Types.ObjectId,ref:"Organization"},organizationName:String,logoUrl:String,access:Array,isPasswordChanged:Boolean,modifiedBy:String,createdBy:String},{timestamps:!0}));e.exports=a},3874:(e,t,s)=>{const i=s(2127).Router(),{body:a}=s(7756),n=s(2523),r=s(7537);i.post("/signup",[a("email").trim().isLength({min:5}).notEmpty(),a("password").trim().isLength({min:8}).notEmpty(),a("isAdmin")],n.signup),i.post("/signin",[a("email").trim().isLength({min:5}).withMessage("Minimal length is 5").notEmpty().withMessage("This field is required"),a("password").trim().isLength({min:6}).withMessage("Minimal length is 8").notEmpty().withMessage("This field is required")],r,n.signin),i.put("/change",[a("oldPassword").trim().isLength({min:8}),a("newPassword").trim().isLength({min:8})],n.changePassword),e.exports=i},9929:(e,t,s)=>{const i=s(2127).Router(),{body:a}=s(7756),n=s(410),r=s(7537);i.get("/",n.listAllCategories),i.post("/get",n.getCategory),i.post("/create",[a("name").notEmpty().withMessage("This field is required"),a("siteId").notEmpty().withMessage("This field is required")],r,n.addCategory),i.post("/edit",[a("id").notEmpty().withMessage("This field is required"),a("name").notEmpty().withMessage("This field is required"),a("siteId").notEmpty().withMessage("This field is required")],r,n.editCategory),i.delete("/delete",n.deleteCategory),e.exports=i},2498:(e,t,s)=>{const i=s(2127).Router(),{body:a}=s(7756),n=s(9114),r=s(7537);i.get("/list",[],n.getAll),i.post("/create",[a("question").notEmpty().withMessage("This field is required")],r,n.create),i.post("/edit",[a("question").notEmpty().withMessage("This field is required")],r,n.edit),i.delete("/delete",[a("id").trim().isLength({min:5})],n.delete),i.get("/get",n.get),e.exports=i},1542:(e,t,s)=>{const i=s(2127).Router(),a=s(1883);i.get("/",a.listAllMaps),i.get("/get",a.getMap),i.post("/create",a.addMap),i.post("/edit",a.editMap),i.delete("/delete",a.deleteMap),e.exports=i},1213:(e,t,s)=>{const i=s(2127).Router(),{body:a}=s(7756),n=s(8570),r=s(7537);i.get("/list",[],n.getAll),i.post("/create",[a("name").notEmpty().withMessage("This field is required")],r,n.create),i.post("/edit",[a("name").notEmpty().withMessage("This field is required")],r,n.edit),i.delete("/delete",[a("id").trim().isLength({min:5})],n.delete),i.get("/get",n.get),i.get("/calendar",n.calendar),e.exports=i},8495:(e,t,s)=>{const i=s(2127).Router(),{body:a}=s(7756),n=s(4973),r=s(7537);i.get("/",n.listAllOrganizations),i.post("/get",n.getOrganization),i.post("/create",[a("name").notEmpty().withMessage("This field is required")],r,n.addOrganization),i.post("/:id",[a("name").notEmpty().withMessage("This field is required")],r,n.editOrganization),i.delete("/delete",n.deleteOrganization),e.exports=i},6976:(e,t,s)=>{const i=s(2127).Router(),{body:a}=s(7756),n=s(4520);i.get("/list",[],n.getAll),i.post("/create",[a("name").trim().isLength({min:5}),a("desc").trim(),a("category").trim(),a("floor").trim(),a("location").trim(),a("logo").trim(),a("logoUrl").trim(),a("opentime").trim(),a("phone").trim(),a("priority").trim(),a("siteId").trim(),a("tag").trim(),a("url").trim()],n.create),i.put("/edit",[a("id").trim().isLength({min:5}),a("name").trim().isLength({min:5}),a("desc").trim().isLength({min:8})],n.edit),i.delete("/delete",[a("id").trim().isLength({min:5})],n.delete),e.exports=i},6098:(e,t,s)=>{const i=s(2127).Router(),{body:a}=s(7756),n=s(534);i.get("/list",n.getAll),i.post("/create",[a("name").trim().isLength({min:5}),a("desc").trim().isLength({min:5}),a("siteId").trim().isLength({min:5})],n.create),i.post("/edit",[a("id").trim().isLength({min:5}),a("name").trim().isLength({min:5}),a("desc").trim().isLength({min:8})],n.edit),i.delete("/delete",[a("id").trim().isLength({min:5})],n.delete),e.exports=i},5070:(e,t,s)=>{const i=s(2127),{body:a}=s(7756),n=i.Router(),r=s(4955);n.post("/create",[a("feedbackId").notEmpty().withMessage("This field is required"),a("star").notEmpty().withMessage("This field is required")],r.create),n.get("/get",r.get),e.exports=n},9147:(e,t,s)=>{const i=s(2127).Router(),{body:a}=s(7756),n=s(8130),r=s(7537);i.get("/list",[],n.getAll),i.post("/create",[a("image").notEmpty().withMessage("This field is required")],r,n.create),i.delete("/delete",[a("id").trim().isLength({min:5})],n.delete),i.get("/get",n.get),i.get("/getEveryHour",n.getEveryHour),i.get("/getStatus",n.getStatus),e.exports=i},3398:(e,t,s)=>{const i=s(2127).Router(),{body:a}=s(7756),n=s(8611),r=s(7537);i.get("/",n.listAllSites),i.post("/get",n.getSite),i.post("/create",[a("name").notEmpty().withMessage("This field is required")],r,n.addSite),i.post("/:id",[a("name").notEmpty().withMessage("This field is required")],r,n.editSite),i.delete("/delete",n.deleteSite),e.exports=i},3800:(e,t,s)=>{const i=s(2127).Router(),{body:a}=s(7756),n=s(7802),r=s(189),o=s(7537),{mongoose:d}=(s(5484),s(6524));i.post("/win",[a("win").trim(),a("email").trim().isLength({min:5}),a("mobile").trim().isLength({min:5}),a("first").trim().isLength({min:2}),a("last").trim().isLength({min:2}),a("birthday").trim().isLength({min:5}),a("optin").trim().isLength({min:3})],n.win),i.get("/",n.listAllUsers),i.post("/get",n.getUser),i.post("/create",[a("email").notEmpty().withMessage("This field is required").isEmail().withMessage("This field must be an email").trim().custom((e=>r.findOne({email:e}).then((e=>{if(e)return Promise.reject("Email already taken! Please choose another one")}))))],o,n.addUser),i.post("/edit",[a("email").notEmpty().withMessage("This field is required").isEmail().withMessage("This field must be an email").custom(((e,{req:t})=>r.findOne({email:e,_id:{$ne:d.Types.ObjectId(t.body.id)}}).then((e=>{if(e)return Promise.reject("Email already taken! Please choose another one")}))))],o,n.editUser),i.delete("/delete",n.deleteUser),i.post("/access",n.access),e.exports=i},9751:e=>{"use strict";e.exports=JSON.parse('{"swagger":"2.0","info":{"version":"1.0.0","title":"Adsign API","description":"Adsign API","license":{"name":"MIT","url":"https://opensource.org/licenses/MIT"}},"host":"localhost:5000","basePath":"/","tags":[{"name":"Auth","description":"API for Authentication"},{"name":"Media","description":"Media API"},{"name":"Feedback","description":"Feedback API"},{"name":"Respondent","description":"Respondent API"},{"name":"User","description":"User API"},{"name":"Site","description":"Site API"},{"name":"Organization","description":"Organization API"},{"name":"Media Category","description":"Media Category API"},{"name":"POI","description":"POI API"},{"name":"POI Category","description":"POI Category API"},{"name":"Map","description":"Map API"}],"schemes":["http"],"consumes":["application/json"],"produces":["application/json"],"paths":{"/auth/signin":{"post":{"tags":["Auth"],"description":"Login to system","parameters":[{"name":"login","in":"body","description":"Login","schema":{"required":["email","password"],"properties":{"email":{"type":"string"},"password":{"type":"string"}}}}],"produces":["application/json"],"responses":{"200":{"description":"Login success"},"422":{"description":"Validation error"}}}},"/auth/change":{"put":{"tags":["Auth"],"description":"Change password","parameters":[{"name":"change password","in":"body","description":"Login","schema":{"required":["oldPassword","newPassword"],"properties":{"oldPassword":{"type":"string"},"newPassword":{"type":"string"}}}}],"security":[{"Bearer":[]}],"produces":["application/json"],"responses":{"201":{"description":"Change password success"},"422":{"description":"Validation error"}}}},"/media/list":{"get":{"tags":["Media"],"description":"List all media","parameters":[{"name":"siteId","in":"query","schema":{"type":"string"},"required":true,"description":"Site ID"}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"Media fetched successfully"},"401":{"description":"Unauthorize"}}}},"/media/create":{"post":{"tags":["Media"],"description":"Create Media","consumes":["multipart/form-data"],"parameters":[{"name":"file","in":"formData","description":"Media Image","type":"file","requried":true},{"name":"path","in":"formData","description":"Path where images store","type":"string","default":"media"},{"name":"name","type":"string","in":"formData","description":"Media Name"},{"name":"description","type":"string","in":"formData","description":"description media"},{"name":"siteId","type":"string","in":"formData","description":"site Id"},{"name":"categoryId","type":"string","in":"formData","description":"category Id"},{"name":"categoryName","type":"string","in":"formData","description":"category name"},{"name":"days","type":"string","in":"formData","description":"days formatted as json array but in string","default":"[]"},{"name":"dates","type":"string","in":"formData","description":"dates formatted as json array but in string","default":"[]"},{"name":"duration","type":"number","description":"duration in second","in":"formData"},{"name":"color","type":"string","description":"color for calendar event with hexadecimal","in":"formData"},{"name":"type","type":"enum","description":"media type date|day|all","in":"formData"},{"name":"start","type":"date","description":"Start date media yyyy-mm-dd","in":"formData"},{"name":"end","type":"date","description":"End date media yyyy-mm-dd","in":"formData"}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"201":{"description":"Media saved successfully"},"401":{"description":"Unauthorize"}}}},"/media/get":{"get":{"tags":["Media"],"description":"get media by id","parameters":[{"name":"id","in":"query","schema":{"type":"string"},"required":true,"description":"Media ID"}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"Media get successfully"},"401":{"description":"Unauthorize"}}}},"/media/edit":{"post":{"tags":["Media"],"description":"Edit Media","consumes":["multipart/form-data"],"parameters":[{"name":"id","in":"formData","description":"Media Id","type":"string","requried":true},{"name":"file","in":"formData","description":"Media Image","type":"file","requried":true},{"name":"path","in":"formData","description":"Path where images store","type":"string","default":"media"},{"name":"name","type":"string","in":"formData","description":"Media Name"},{"name":"description","type":"string","in":"formData","description":"description media"},{"name":"siteId","type":"string","in":"formData","description":"site Id"},{"name":"categoryId","type":"string","in":"formData","description":"category Id"},{"name":"categoryName","type":"string","in":"formData","description":"category name"},{"name":"days","type":"string","in":"formData","description":"days formatted as json array but in string","default":"[]"},{"name":"dates","type":"string","in":"formData","description":"dates formatted as json array but in string","default":"[]"},{"name":"duration","type":"number","description":"duration in second","in":"formData"},{"name":"color","type":"string","description":"color for calendar event with hexadecimal","in":"formData"},{"name":"type","type":"enum","description":"media type date|day|all","in":"formData"},{"name":"start","type":"date","description":"Start date media yyyy-mm-dd","in":"formData"},{"name":"end","type":"date","description":"End date media yyyy-mm-dd","in":"formData"}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"201":{"description":"Media saved successfully"},"401":{"description":"Unauthorize"}}}},"/media/delete":{"delete":{"tags":["Media"],"description":"delete media by id","parameters":[{"name":"id","in":"query","schema":{"type":"string"},"required":true,"description":"Media ID"}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"Media get successfully"},"401":{"description":"Unauthorize"}}}},"/feedback/list":{"get":{"tags":["Feedback"],"description":"List all feedback","parameters":[{"name":"siteId","in":"query","schema":{"type":"string"},"required":true,"description":"Site ID"}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"Feedback fetched successfully"},"401":{"description":"Unauthorize"}}}},"/feedback/create":{"post":{"tags":["Feedback"],"description":"Create feedback","parameters":[{"name":"body","in":"body","schema":{"required":["question","siteId"],"properties":{"question":{"type":"string"},"siteId":{"type":"string"},"start":{"type":"string","description":"yyyy-mm-dd"},"end":{"type":"string","description":"yyyy-mm-dd"}}}}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"201":{"description":"Feedback created successfully"},"401":{"description":"Unauthorize"}}}},"/feedback/get":{"get":{"tags":["Feedback"],"description":"get feedback by ID","parameters":[{"name":"id","in":"query","schema":{"type":"string"},"required":true,"description":"Feedback ID"}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"Feedback get successfully"},"401":{"description":"Unauthorize"}}}},"/feedback/edit":{"post":{"tags":["Feedback"],"description":"Create feedback","parameters":[{"name":"body","in":"body","schema":{"required":["question","siteId"],"properties":{"id":{"type":"string","description":"feedback ID"},"question":{"type":"string"},"siteId":{"type":"string"},"start":{"type":"string","description":"yyyy-mm-dd"},"end":{"type":"string","description":"yyyy-mm-dd"}}}}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"201":{"description":"Feedback created successfully"},"401":{"description":"Unauthorize"}}}},"/feedback/delete":{"delete":{"tags":["Feedback"],"description":"delete feedback by ID","parameters":[{"name":"id","in":"query","schema":{"type":"string"},"required":true,"description":"Feedback ID"}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"Feedback deleted successfully"},"401":{"description":"Unauthorize"}}}},"/respondent/get":{"get":{"tags":["Respondent"],"description":"get feedback chart by feedback ID","parameters":[{"name":"id","in":"query","schema":{"type":"string"},"required":true,"description":"Feedback ID"}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"Respondent get successfully"},"401":{"description":"Unauthorize"}}}},"/respondent/create":{"post":{"tags":["Respondent"],"description":"Create respondent","parameters":[{"name":"body","in":"body","schema":{"required":["feedbackID","star"],"properties":{"star":{"type":"number"},"feedbackId":{"type":"string"}}}}],"producers":["application/json"],"responses":{"201":{"description":"Respondent created successfully"}}}},"/user":{"get":{"tags":["User"],"description":"List all users","producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"User fetched successfully"},"401":{"description":"Unauthorize"}}}},"/user/create":{"post":{"tags":["User"],"description":"Create User","consumes":["multipart/form-data"],"parameters":[{"name":"file","in":"formData","description":"User Image","type":"file","requried":true},{"name":"path","in":"formData","description":"Path where images store","type":"string","default":"user","requried":true},{"name":"name","type":"string","in":"formData","description":"User Name","requried":true},{"name":"email","type":"string","in":"formData","description":"User Email","requried":true},{"name":"password","type":"string","in":"formData","description":"User Password","requried":true},{"name":"organizationId","type":"string","in":"formData","description":"user organization ID","requried":true},{"name":"organizationName","type":"string","in":"formData","description":"user organization Name","requried":true},{"name":"isAdmin","type":"boolean","in":"formData","description":"wheter the user is admin or not","default":false,"requried":true}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"201":{"description":"User saved successfully"},"401":{"description":"Unauthorize"}}}},"/user/get":{"post":{"tags":["User"],"description":"get user by Id","producers":["application/json"],"security":[{"Bearer":[]}],"parameters":[{"name":"user body","in":"body","schema":{"required":["id"],"properties":{"id":{"type":"string"}}}}],"responses":{"200":{"description":"User fetched successfully"},"401":{"description":"Unauthorize"}}}},"/user/edit":{"post":{"tags":["User"],"description":"Edit User","consumes":["multipart/form-data"],"parameters":[{"name":"file","in":"formData","description":"User Image","type":"file","requried":true},{"name":"path","in":"formData","description":"Path where images store","type":"string","default":"user","requried":true},{"name":"id","in":"formData","description":"User ID","type":"string","requried":true},{"name":"name","type":"string","in":"formData","description":"User Name","requried":true},{"name":"email","type":"string","in":"formData","description":"User Email","requried":true},{"name":"password","type":"string","in":"formData","description":"User Password"},{"name":"organizationId","type":"string","in":"formData","description":"user organization ID","requried":true},{"name":"organizationName","type":"string","in":"formData","description":"user organization Name","requried":true},{"name":"isAdmin","type":"boolean","in":"formData","description":"wheter the user is admin or not","default":false,"requried":true}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"201":{"description":"User saved successfully"},"401":{"description":"Unauthorize"}}}},"/user/access":{"post":{"tags":["User"],"description":"update user access","producers":["application/json"],"security":[{"Bearer":[]}],"parameters":[{"name":"user body","in":"body","schema":{"required":["access"],"properties":{"_id":{"type":"string"},"access":{"type":"array","example":[{"admin":true,"analytics":true,"media":true,"poi":true,"siteId":"603322a59591f7e39d7389f0"}]}}}}],"responses":{"200":{"description":"User access modified successfully"},"401":{"description":"Unauthorize"}}}},"/user/delete":{"delete":{"tags":["User"],"description":"delete user","producers":["application/json"],"security":[{"Bearer":[]}],"parameters":[{"name":"id","in":"query","schema":{"id":"string","required":true}}],"responses":{"201":{"description":"User deleted successfully"},"401":{"description":"Unauthorize"}}}},"/site":{"get":{"tags":["Site"],"description":"List all site","producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"Site fetched successfully"},"401":{"description":"Unauthorize"}}}},"/site/create":{"post":{"tags":["Site"],"description":"Create site","parameters":[{"name":"body","in":"body","schema":{"required":["name","organizationId","organizationName"],"properties":{"name":{"type":"string"},"organizationId":{"type":"string"},"organizationName":{"type":"string"},"description":{"type":"string"}}}}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"201":{"description":"Site created successfully"},"401":{"description":"Unauthorize"}}}},"/site/get":{"post":{"tags":["Site"],"description":"get site by ID","parameters":[{"name":"Site Body","in":"body","schema":{"required":["id"],"properties":{"id":{"type":"string"}}}}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"Site get successfully"},"401":{"description":"Unauthorize"}}}},"/site/{id}":{"post":{"tags":["Site"],"description":"Update site","parameters":[{"name":"id","in":"path","schema":{"type":"string","required":true}},{"name":"body","in":"body","schema":{"required":["name","organizationId","organizationName"],"properties":{"name":{"type":"string"},"organizationId":{"type":"string"},"organizationName":{"type":"string"},"description":{"type":"string"}}}}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"201":{"description":"Site updated successfully"},"401":{"description":"Unauthorize"}}}},"/site/delete":{"delete":{"tags":["Site"],"description":"delete site by ID","parameters":[{"name":"id","in":"query","schema":{"type":"string"},"required":true,"description":"Site ID"}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"Site deleted successfully"},"401":{"description":"Unauthorize"}}}},"/organization":{"get":{"tags":["Organization"],"description":"List all organization","producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"Organization fetched successfully"},"401":{"description":"Unauthorize"}}}},"/organization/create":{"post":{"tags":["Organization"],"description":"Create organization","parameters":[{"name":"body","in":"body","schema":{"required":["name"],"properties":{"name":{"type":"string"},"description":{"type":"string"}}}}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"201":{"description":"Organization created successfully"},"401":{"description":"Unauthorize"}}}},"/organization/get":{"post":{"tags":["Organization"],"description":"get organization by ID","parameters":[{"name":"Organization Body","in":"body","schema":{"required":["id"],"properties":{"id":{"type":"string"}}}}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"Organization get successfully"},"401":{"description":"Unauthorize"}}}},"/organization/{id}":{"post":{"tags":["Organization"],"description":"Update organization","parameters":[{"name":"id","in":"path","schema":{"type":"string","required":true}},{"name":"body","in":"body","schema":{"required":["name","organizationId","organizationName"],"properties":{"name":{"type":"string"},"description":{"type":"string"}}}}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"201":{"description":"Organization updated successfully"},"401":{"description":"Unauthorize"}}}},"/organization/delete":{"delete":{"tags":["Organization"],"description":"delete organization by ID","parameters":[{"name":"id","in":"query","schema":{"type":"string"},"required":true,"description":"Organization ID"}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"Organization deleted successfully"},"401":{"description":"Unauthorize"}}}},"/category":{"get":{"tags":["Media Category"],"description":"List all category","producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"Media Category fetched successfully"},"401":{"description":"Unauthorize"}}}},"/category/create":{"post":{"tags":["Media Category"],"description":"Create category","parameters":[{"name":"body","in":"body","schema":{"required":["name"],"properties":{"name":{"type":"string"},"description":{"type":"string"},"siteId":{"type":"string"}}}}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"201":{"description":"Media Category created successfully"},"401":{"description":"Unauthorize"}}}},"/category/get":{"post":{"tags":["Media Category"],"description":"get category by ID","parameters":[{"name":"Media Category Body","in":"body","schema":{"required":["id"],"properties":{"id":{"type":"string"}}}}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"Media Category get successfully"},"401":{"description":"Unauthorize"}}}},"/category/edit":{"post":{"tags":["Media Category"],"description":"Update category","parameters":[{"name":"body","in":"body","schema":{"required":["id","name","categoryId","categoryName"],"properties":{"id":{"type":"string"},"name":{"type":"string"},"description":{"type":"string"},"siteId":{"type":"string"}}}}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"201":{"description":"Media Category updated successfully"},"401":{"description":"Unauthorize"}}}},"/category/delete":{"delete":{"tags":["Media Category"],"description":"delete category by ID","parameters":[{"name":"id","in":"query","schema":{"type":"string"},"required":true,"description":"Media Category ID"}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"Media Category deleted successfully"},"401":{"description":"Unauthorize"}}}},"/poi/list":{"get":{"tags":["POI"],"description":"List all poi","producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"POI fetched successfully"},"401":{"description":"Unauthorize"}}}},"/poi/create":{"post":{"tags":["POI"],"description":"Create poi","consumes":["multipart/form-data"],"parameters":[{"name":"file","in":"formData","description":"POI Image","type":"file","requried":true},{"name":"path","in":"formData","description":"Path where images store","type":"string","default":"poi"},{"name":"name","type":"string","in":"formData","description":"POI Name"},{"name":"description","type":"string","in":"formData","description":"POI description"},{"name":"siteId","type":"string","in":"formData","description":"site Id"},{"name":"categoryId","type":"string","in":"formData","description":"category Id"},{"name":"categoryName","type":"string","in":"formData","description":"category name"},{"name":"floor","type":"string","in":"formData","description":"poi floor"},{"name":"location","type":"string","in":"formData","description":"poi location"},{"name":"opentime","type":"string","in":"formData","description":"poi opentime"},{"name":"phone","type":"string","in":"formData","description":"poi phone"},{"name":"priority","type":"string","in":"formData","description":"poi priority"},{"name":"tag","type":"string","in":"formData","description":"poi tag"},{"name":"url","type":"string","in":"formData","description":"poi url"}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"201":{"description":"POI created successfully"},"401":{"description":"Unauthorize"}}}},"/poi/edit":{"put":{"tags":["POI"],"description":"Update poi","consumes":["multipart/form-data"],"parameters":[{"name":"id","in":"formData","description":"POI ID","type":"string","requried":true},{"name":"file","in":"formData","description":"POI Image","type":"file","requried":true},{"name":"path","in":"formData","description":"Path where images store","type":"string","default":"poi"},{"name":"name","type":"string","in":"formData","description":"POI Name"},{"name":"description","type":"string","in":"formData","description":"POI description"},{"name":"siteId","type":"string","in":"formData","description":"site Id"},{"name":"categoryId","type":"string","in":"formData","description":"category Id"},{"name":"categoryName","type":"string","in":"formData","description":"category name"},{"name":"floor","type":"string","in":"formData","description":"poi floor"},{"name":"location","type":"string","in":"formData","description":"poi location"},{"name":"opentime","type":"string","in":"formData","description":"poi opentime"},{"name":"phone","type":"string","in":"formData","description":"poi phone"},{"name":"priority","type":"string","in":"formData","description":"poi priority"},{"name":"tag","type":"string","in":"formData","description":"poi tag"},{"name":"url","type":"string","in":"formData","description":"poi url"}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"201":{"description":"POI updated successfully"},"401":{"description":"Unauthorize"}}}},"/poi/delete":{"delete":{"tags":["POI"],"description":"delete poi by ID","parameters":[{"name":"id","in":"query","schema":{"type":"string"},"required":true,"description":"POI ID"}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"POI deleted successfully"},"401":{"description":"Unauthorize"}}}},"/poiCategory/list":{"get":{"tags":["POI Category"],"description":"List all poiCategory","producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"POI Category fetched successfully"},"401":{"description":"Unauthorize"}}}},"/poiCategory/create":{"post":{"tags":["POI Category"],"description":"Create poiCategory","parameters":[{"name":"body","in":"body","schema":{"required":["name"],"properties":{"name":{"type":"string"},"description":{"type":"string"},"siteId":{"type":"string"}}}}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"201":{"description":"POI Category created successfully"},"401":{"description":"Unauthorize"}}}},"/poiCategory/edit":{"post":{"tags":["POI Category"],"description":"Update poiCategory","parameters":[{"name":"body","in":"body","schema":{"required":["id","name","siteId"],"properties":{"id":{"type":"string"},"name":{"type":"string"},"description":{"type":"string"},"siteId":{"type":"string"}}}}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"201":{"description":"POI Category updated successfully"},"401":{"description":"Unauthorize"}}}},"/poiCategory/delete":{"delete":{"tags":["POI Category"],"description":"delete POI Category by ID","parameters":[{"name":"id","in":"query","schema":{"type":"string"},"required":true,"description":"POI Category ID"}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"POI Category deleted successfully"},"401":{"description":"Unauthorize"}}}},"/map":{"get":{"tags":["Map"],"description":"List all Map","producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"Map fetched successfully"},"401":{"description":"Unauthorize"}}}},"/map/create":{"post":{"tags":["Map"],"description":"Create Map","consumes":["multipart/form-data"],"parameters":[{"name":"file","in":"formData","description":"Map Image","type":"file","requried":true},{"name":"path","in":"formData","description":"Path where images store","type":"string","default":"map"},{"name":"name","type":"string","in":"formData","description":"Map Name"},{"name":"description","type":"string","in":"formData","description":"Map description"},{"name":"siteId","type":"string","in":"formData","description":"site Id"}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"201":{"description":"Map created successfully"},"401":{"description":"Unauthorize"}}}},"/map/get":{"get":{"tags":["Map"],"description":"get map by ID","parameters":[{"name":"id","in":"query","schema":{"type":"string"},"required":true,"description":"Map ID"}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"Map deleted successfully"},"401":{"description":"Unauthorize"}}}},"/map/edit":{"post":{"tags":["Map"],"description":"Update map","consumes":["multipart/form-data"],"parameters":[{"name":"id","in":"formData","description":"Map ID","type":"string","requried":true},{"name":"file","in":"formData","description":"Map Image","type":"file","requried":true},{"name":"path","in":"formData","description":"Path where images store","type":"string","default":"map"},{"name":"name","type":"string","in":"formData","description":"Map Name"},{"name":"description","type":"string","in":"formData","description":"Map description"},{"name":"siteId","type":"string","in":"formData","description":"site Id"},{"name":"body","in":"body","schema":{"required":["path","userPos"],"properties":{"paths":{"type":"array","example":[{"destLoc":"101,144","pathId":"asdf","pathLines":["225,226","129,156"],"pathName":"Path 01"}]},"userPos":{"type":"string","example":"215,214"}}}}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"201":{"description":"Map updated successfully"},"401":{"description":"Unauthorize"}}}},"/map/delete":{"delete":{"tags":["Map"],"description":"delete map by ID","parameters":[{"name":"id","in":"query","schema":{"type":"string"},"required":true,"description":"Map ID"}],"producers":["application/json"],"security":[{"Bearer":[]}],"responses":{"200":{"description":"Map deleted successfully"},"401":{"description":"Unauthorize"}}}}},"securityDefinitions":{"Bearer":{"type":"apiKey","name":"Authorization","in":"header"}}}')},5484:(e,t,s)=>{const i=s(9722),a=s(8059);t.authenticateJWT=(e,t,s)=>{const n=e.headers.authorization;if(!n)return t.sendStatus(401);{const s=n.split(" ")[1];i.verify(s,a.secret,((s,i)=>{if(s)return t.sendStatus(403);e.user=i}))}}},7537:(e,t,s)=>{const{validationResult:i}=s(7756),a=s(2164);e.exports=(e,t,s)=>{const n=i(e);if(n.isEmpty())return s();const r=a.chain(n.errors).groupBy("param");return t.status(422).json({errors:r,message:"Something went wrong!"})}},8983:e=>{"use strict";e.exports=require("@elastic/elasticsearch")},2773:e=>{"use strict";e.exports=require("bcryptjs")},2473:e=>{"use strict";e.exports=require("body-parser")},479:e=>{"use strict";e.exports=require("cors")},334:e=>{"use strict";e.exports=require("dotenv")},2127:e=>{"use strict";e.exports=require("express")},7756:e=>{"use strict";e.exports=require("express-validator")},4054:e=>{"use strict";e.exports=require("firebase-admin")},5747:e=>{"use strict";e.exports=require("fs")},9722:e=>{"use strict";e.exports=require("jsonwebtoken")},2470:e=>{"use strict";e.exports=require("moment")},7548:e=>{"use strict";e.exports=require("mongodb")},5619:e=>{"use strict";e.exports=require("mongoose")},8633:e=>{"use strict";e.exports=require("multer")},8123:e=>{"use strict";e.exports=require("nodemailer")},5622:e=>{"use strict";e.exports=require("path")},6677:e=>{"use strict";e.exports=require("swagger-ui-express")},2164:e=>{"use strict";e.exports=require("underscore")},1231:e=>{"use strict";e.exports=require("uuid")}},t={};function s(i){var a=t[i];if(void 0!==a)return a.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,s),n.exports}(()=>{s(334).config();const e=s(2127),t=s(2473),i=s(5619),a=s(5622),n=s(8633),{v4:r}=s(1231),o=s(479),{Client:d}=s(8983);var c=s(5747);const p=s(3800),m=s(3874),u=s(3398),y=s(8495),l=s(6976),g=s(6098),h=s(9929),f=s(1213),b=s(1542),I=s(2498),w=s(5070),S=s(9147),D=s(6677),A=s(9751),q=(s(5214),new d({node:"http://localhost:9200"}),e());q.use(o()),q.use(t.json({limit:"50mb"})),q.use(t.urlencoded({extended:!0,limit:"50mb"}));const O=n.diskStorage({destination:(e,t,s)=>{const i=e.body.path?e.body.path:"";c.existsSync("images/"+i)||c.mkdirSync("images/"+i,{recursive:!0}),s(null,`images/${i}`)},filename:(e,t,s)=>{s(null,r()+"-"+t.originalname)}});q.use(n({storage:O,fileFilter:(e,t,s)=>{"image/jpg"===t.mimetype||"image/png"===t.mimetype||"image/jpeg"===t.mimetype||"video/mp4"===t.mimetype?s(null,!0):s(null,!1)}}).single("file")),q.use("/images",e.static(a.join(__dirname,"images"))),q.use(((e,t,s)=>{t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, PATCH, DELETE"),s()})),q.use("/user",p),q.use("/auth",m),q.use("/site",u),q.use("/organization",y),q.use("/poi",l),q.use("/poiCategory",g),q.use("/category",h),q.use("/media",f),q.use("/map",b),q.use("/feedback",I),q.use("/respondent",w),q.use("/screenshot",S),q.use("/docs",D.serve,D.setup(A)),q.use(((e,t,s,i)=>{console.log(e);const a=e.statusCode||500,{message:n,data:r}=e;return s.status(a).json({message:n,data:r})})),i.set("useFindAndModify",!1),i.connect("mongodb://localhost:27017/adsign",{useNewUrlParser:!0,useUnifiedTopology:!0}).then((e=>{q.listen("5000",(()=>console.log("App ready")))})).catch((e=>console.log("ATLAS CONNECTION ERROR: ",e)))})()})();